
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="JavaScript Property Testing">
      
      
        <meta name="author" content="kindone">
      
      
        <link rel="canonical" href="https://github.com/pages/kindone/jsproptest/stateful-testing/">
      
      
        <link rel="prev" href="../shrinking/">
      
      
      
      <link rel="icon" href="../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.7">
    
    
      
        <title>Stateful & Concurrency Testing - jsproptest</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CSpline+Sans+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Spline Sans Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="light-green">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#stateful-testing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="jsproptest" class="md-header__button md-logo" aria-label="jsproptest" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            jsproptest
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Stateful & Concurrency Testing
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/kindone/jsproptest" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kindone/jsproptest
  </div>
</a>
      </div>
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="jsproptest" class="md-nav__button md-logo" aria-label="jsproptest" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    jsproptest
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kindone/jsproptest" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kindone/jsproptest
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../README.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../properties/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Properties
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Generating Inputs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Generating Inputs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../generators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../combinators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Combinators
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../shrinking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shrinking
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Stateful & Concurrency Testing
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Stateful & Concurrency Testing
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    Core Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-stateful-property" class="md-nav__link">
    Creating a Stateful Property
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shrinking" class="md-nav__link">
    Shrinking
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    Core Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-stateful-property" class="md-nav__link">
    Creating a Stateful Property
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shrinking" class="md-nav__link">
    Shrinking
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="stateful-testing">Stateful Testing<a class="headerlink" href="#stateful-testing" title="Permanent link">&para;</a></h1>
<p>Stateful testing involves defining a sequence of actions or commands that can be applied to a system under test and verifying properties or invariants about the system's state after executing these sequences.</p>
<p><code>jsproptest</code> provides utilities for defining state machines and generating sequences of commands to effectively test stateful systems. It allows you to model the state of your system, define actions that change the state, and automatically run sequences of these actions to find bugs.</p>
<h2 id="core-concepts">Core Concepts<a class="headerlink" href="#core-concepts" title="Permanent link">&para;</a></h2>
<p>Stateful testing in <code>jsproptest</code> revolves around the <code>StatefulProperty</code> class, which orchestrates the test execution. Here are the key components:</p>
<ol>
<li><strong>Initial State (<code>ObjectType</code>)</strong>: You need a generator (<code>Generator&lt;ObjectType&gt;</code>) that produces the initial state of the system under test for each test run.</li>
<li><strong>Actions (<code>Action</code> or <code>SimpleAction</code>)</strong>: Actions represent operations that modify the system's state.<ul>
<li><code>SimpleAction</code>: Used when you don't need an explicit model. It takes a function <code>(obj: ObjectType) =&gt; void</code>.</li>
<li><code>Action</code>: Used when you have a model. It takes a function <code>(obj: ObjectType, model: ModelType) =&gt; void</code> and updates both the real object and the model.</li>
</ul>
</li>
<li><strong>Model (<code>ModelType</code>, Optional)</strong>: A simplified representation of the system's state. It's used to verify the correctness of the actual system's state after each action.</li>
<li><strong>Model Factory (<code>modelFactory</code>, Optional)</strong>: A function <code>(obj: ObjectType) =&gt; ModelType</code> that creates the initial model state based on the initial object state. Required if using a model.</li>
<li><strong>Action Generation (<code>actionGenFactory</code> or <code>simpleActionGenFactory</code>)</strong>: A factory function that returns a generator for the <em>next</em> action based on the <em>current</em> state of the object (and model, if applicable).<ul>
<li><code>SimpleActionGenFactory</code>: <code>(obj: ObjectType) =&gt; Generator&lt;SimpleAction&lt;ObjectType&gt;&gt;</code></li>
<li><code>ActionGenFactory</code>: <code>(obj: ObjectType, model: ModelType) =&gt; Generator&lt;Action&lt;ObjectType, ModelType&gt;&gt;</code>
<code>jsproptest</code> provides helpers like <code>Gen.simpleActionOf</code> and <code>Gen.actionOf</code> to combine multiple action generators.</li>
</ul>
</li>
</ol>
<h2 id="creating-a-stateful-property">Creating a Stateful Property<a class="headerlink" href="#creating-a-stateful-property" title="Permanent link">&para;</a></h2>
<p>You typically use factory functions to create a <code>StatefulProperty</code>:</p>
<ul>
<li>
<p><strong><code>simpleStatefulProperty&lt;ObjectType&gt;(initialGen, simpleActionGenFactory)</code></strong>: Use this when you don't need an explicit model. Checks are usually performed within the <code>SimpleAction</code> implementations (e.g., asserting invariants after an operation).</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Gen</span><span class="p">,</span><span class="w"> </span><span class="nx">simpleStatefulProperty</span><span class="p">,</span><span class="w"> </span><span class="nx">SimpleAction</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;jsproptest&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">MySystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span><span class="p">[];</span>

<span class="c1">// Generator for the initial state (e.g., an empty array)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">initialGen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Gen</span><span class="p">.</span><span class="nx">just</span><span class="p">([]);</span>

<span class="c1">// Action: Add an element</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">addActionGen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Gen</span><span class="p">.</span><span class="nx">integer</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span><span class="nx">val</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">SimpleAction</span><span class="p">((</span><span class="nx">arr</span><span class="o">:</span><span class="w"> </span><span class="kt">MySystem</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">oldLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="w">        </span><span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Assert invariant within the action</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">oldLength</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">);</span>

<span class="c1">// Action: Clear the array</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">clearActionGen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Gen</span><span class="p">.</span><span class="nx">just</span><span class="p">(</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">SimpleAction</span><span class="p">((</span><span class="nx">arr</span><span class="o">:</span><span class="w"> </span><span class="kt">MySystem</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">);</span>

<span class="c1">// Combine action generators</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">actionFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Gen</span><span class="p">.</span><span class="nx">oneOf</span><span class="p">(</span><span class="nx">addActionGen</span><span class="p">,</span><span class="w"> </span><span class="nx">clearActionGen</span><span class="p">)</span>

<span class="c1">// Create the property</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">simpleStatefulProperty</span><span class="p">(</span><span class="nx">initialGen</span><span class="p">,</span><span class="w"> </span><span class="nx">actionFactory</span><span class="p">);</span>

<span class="c1">// Run the test</span>
<span class="nx">prop</span><span class="p">.</span><span class="nx">go</span><span class="p">();</span>
</code></pre></div>
</li>
<li>
<p><strong><code>statefulProperty&lt;ObjectType, ModelType&gt;(initialGen, modelFactory, actionGenFactory)</code></strong>: Use this when you want to maintain a separate model to verify the system's behavior against.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Gen</span><span class="p">,</span><span class="w"> </span><span class="nx">statefulProperty</span><span class="p">,</span><span class="w"> </span><span class="nx">Action</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;jsproptest&#39;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">MySystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span><span class="p">[];</span>
<span class="kr">type</span><span class="w"> </span><span class="nx">MyModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">expectedCount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">};</span>

<span class="c1">// Initial state generator</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">initialGen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Gen</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="nx">Gen</span><span class="p">.</span><span class="nx">integer</span><span class="p">(),</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>

<span class="c1">// Model factory</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">modelFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">arr</span><span class="o">:</span><span class="w"> </span><span class="kt">MySystem</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">MyModel</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">expectedCount</span><span class="o">:</span><span class="w"> </span><span class="kt">arr.length</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// Action: Add element (updates object and model)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">addActionGen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Gen</span><span class="p">.</span><span class="nx">integer</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span><span class="nx">val</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">Action</span><span class="p">((</span><span class="nx">arr</span><span class="o">:</span><span class="w"> </span><span class="kt">MySystem</span><span class="p">,</span><span class="w"> </span><span class="nx">model</span><span class="o">:</span><span class="w"> </span><span class="kt">MyModel</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
<span class="w">        </span><span class="nx">model</span><span class="p">.</span><span class="nx">expectedCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Check consistency (optional, can also use postCheck)</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">expectedCount</span><span class="p">);</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">);</span>

<span class="c1">// Action: Remove element (updates object and model)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">removeActionGen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Gen</span><span class="p">.</span><span class="nx">just</span><span class="p">(</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">Action</span><span class="p">((</span><span class="nx">arr</span><span class="o">:</span><span class="w"> </span><span class="kt">MySystem</span><span class="p">,</span><span class="w"> </span><span class="nx">model</span><span class="o">:</span><span class="w"> </span><span class="kt">MyModel</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// Precondition</span>
<span class="w">        </span><span class="nx">arr</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
<span class="w">        </span><span class="nx">model</span><span class="p">.</span><span class="nx">expectedCount</span><span class="o">--</span><span class="p">;</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">expectedCount</span><span class="p">);</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">);</span>

<span class="c1">// Action generator factory</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">actionFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Gen</span><span class="p">.</span><span class="nx">simpleActionOf</span><span class="p">(</span><span class="nx">addActionGen</span><span class="p">,</span><span class="w"> </span><span class="nx">Gen</span><span class="p">.</span><span class="nx">weightedValue</span><span class="p">(</span><span class="nx">removeActionGen</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">))</span>

<span class="c1">// Create the property</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">statefulProperty</span><span class="p">(</span><span class="nx">initialGen</span><span class="p">,</span><span class="w"> </span><span class="nx">modelFactory</span><span class="p">,</span><span class="w"> </span><span class="nx">actionFactory</span><span class="p">);</span>

<span class="c1">// Run the test</span>
<span class="nx">prop</span><span class="p">.</span><span class="nx">go</span><span class="p">();</span>
</code></pre></div>
</li>
</ul>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>The <code>StatefulProperty</code> instance provides several methods for configuration:</p>
<ul>
<li><code>setSeed(string)</code>: Sets the initial seed for the random number generator for reproducible tests.</li>
<li><code>setNumRuns(number)</code>: Sets the number of test sequences to execute (default: 100).</li>
<li><code>setMinActions(number)</code> / <code>setMaxActions(number)</code>: Sets the minimum and maximum number of actions per sequence (default: 1-100).</li>
<li><code>setVerbosity(boolean)</code>: Enables/disables verbose logging during execution.</li>
<li><code>setOnStartup(() =&gt; void)</code>: Sets a function to run before each test sequence.</li>
<li><code>setOnCleanup(() =&gt; void)</code>: Sets a function to run after each successful test sequence.</li>
<li><code>setPostCheck((obj: ObjectType, model: ModelType) =&gt; void)</code>: Sets a function to run after all actions in a sequence have completed successfully. Useful for final state validation. You can also use <code>setPostCheckWithoutModel((obj: ObjectType) =&gt; void)</code>.</li>
</ul>
<h2 id="shrinking">Shrinking<a class="headerlink" href="#shrinking" title="Permanent link">&para;</a></h2>
<p>If a test sequence fails (an action throws an error or the <code>postCheck</code> fails), <code>jsproptest</code> automatically tries to <strong>shrink</strong> the test case to find a minimal reproduction. It does this by:</p>
<ol>
<li><strong>Shrinking the Action Sequence</strong>: Trying shorter sequences or simpler actions.</li>
<li><strong>Shrinking the Initial State</strong>: Trying simpler versions of the initial state generated by <code>initialGen</code>.</li>
</ol>
<p>The goal is to present the simplest possible initial state and sequence of actions that trigger the failure, making debugging easier. The error message will report the shrunk arguments if successful.</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">April 19, 2025</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.tabs.sticky", "navigation.indexes", "navigation.path", "toc.follow", "navigation.top", "search.highlight", "search.suggest", "navigation.expand"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>